module.controller("GroupListCtrl",(function(e,r,t,l,n,a,o,s,i,u,c,d,p){e.realm=l,e.groupList=[{id:"realm",name:p.instant("groups"),subGroups:[]}],e.searchCriteria="",e.currentPage=1,e.currentPageInput=e.currentPage,e.pageSize=20,e.numberOfPages=1,e.tree=[];var m=function(r){console.log("refreshGroups"),e.currentPageInput=e.currentPage;var o=e.currentPage*e.pageSize-e.pageSize;console.log("first:"+o);var s={realm:l.realm,first:o,max:e.pageSize},u={realm:l.realm,top:"true"};angular.isDefined(r)&&""!==r&&(s.search=r,u.search=r);var c=t.defer();n.query(s,(function(e){c.resolve(e)}),(function(){c.reject(p.instant("group.fetch.fail",{params:s}))})),c.promise.then((function(t){e.groupList=[{id:"realm",name:p.instant("groups"),subGroups:d.sortGroups("name",t)}],angular.isDefined(r)&&""!==r&&setTimeout((function(){document.querySelectorAll("span").forEach((function(e){-1!=e.textContent.indexOf(r)&&angular.element(e).addClass("highlight")}))}),500)}),(function(e){i.error(e)}));var m=t.defer();console.log("countParams: realm["+u.realm),a.query(u,(function(e){m.resolve(e)}),(function(){m.reject(p.instant("group.fetch.fail",{params:u}))})),m.promise.then((function(r){angular.isDefined(r.count)&&r.count>e.pageSize?e.numberOfPages=Math.ceil(r.count/e.pageSize):e.numberOfPages=1}),(function(e){i.error(e)}))};m(),e.$watch("currentPage",(function(r,t){parseInt(r,10)!==t&&m(e.searchCriteria)})),e.clearSearch=function(){e.searchCriteria="",1===parseInt(e.currentPage,10)?m():e.currentPage=1},e.searchGroup=function(){1===parseInt(e.currentPage,10)?m(e.searchCriteria):e.currentPage=1},e.edit=function(e){"realm"!==e.id&&u.url("/realms/"+l.realm+"/groups/"+e.id)},e.cut=function(r){e.cutNode=r},e.isDisabled=function(){return!e.tree.currentNode||"realm"===e.tree.currentNode.id},e.paste=function(t){null!==t&&null!==e.cutNode&&t.id!==e.cutNode.id&&("realm"===t.id?n.save({realm:l.realm},{id:e.cutNode.id},(function(){r.reload(),i.success(p.instant("group.move.success"))})):s.save({realm:l.realm,groupId:t.id},{id:e.cutNode.id},(function(){r.reload(),i.success(p.instant("group.move.success"))})))},e.remove=function(e){null!==e&&c.confirmWithButtonText(p.instant("group.remove.confirm.title",{name:e.name}),p.instant("group.remove.confirm.message",{name:e.name}),p.instant("dialogs.delete.confirm"),(function(){o.remove({realm:l.realm,groupId:e.id},(function(){r.reload(),i.success(p.instant("group.remove.success"))}))}))},e.createGroup=function(e){var r="realm";e&&(r=e.id),u.url("/create/group/"+l.realm+"/parent/"+r)};e.getGroupClass=function(e){return"realm"===e.id?"pficon pficon-users":function(e){return"realm"!==e.id&&(!e.subGroups||0===e.subGroups.length)}(e)?"normal":e.subGroups.length&&e.collapsed?"collapsed":e.subGroups.length&&!e.collapsed?"expanded":"collapsed"},e.getSelectedClass=function(r){return r.selected?"selected":e.cutNode&&e.cutNode.id===r.id?"cut":void 0}})),module.controller("GroupCreateCtrl",(function(e,r,t,l,n,a,o,s,i,u){e.realm=t,e.group={},e.save=function(){console.log("save!!!"),"realm"===l?(console.log("realm"),n.save({realm:t.realm},e.group,(function(e,r){var l=r().location,n=l.substring(l.lastIndexOf("/")+1);i.url("/realms/"+t.realm+"/groups/"+n),s.success(u.instant("group.create.success"))}))):o.save({realm:t.realm,groupId:l},e.group,(function(e,r){var l=r().location,n=l.substring(l.lastIndexOf("/")+1);i.url("/realms/"+t.realm+"/groups/"+n),s.success(u.instant("group.create.success"))}))},e.cancel=function(){i.url("/realms/"+t.realm+"/groups")}})),module.controller("GroupTabCtrl",(function(e,r,t,l,n,a,o){r.removeGroup=function(){e.confirmWithButtonText(o.instant("group.remove.confirm.title",{name:r.group.name}),o.instant("group.remove.confirm.message",{name:r.group.name}),o.instant("dialogs.delete.confirm"),(function(){l.remove({realm:t.realm.realm,groupId:r.group.id},(function(){a.url("/realms/"+t.realm.realm+"/groups"),n.success(o.instant("group.remove.success"))}))}))}})),module.controller("GroupDetailCtrl",(function(e,r,t,l,n,a,o,s){function i(e){var r=e.attributes;for(var t in r)"object"===typeof r[t]&&(r[t]=r[t].join("##"))}r.realm=t,l.attributes||(l.attributes={}),i(l),r.group=angular.copy(l),r.changed=!1,r.$watch("group",(function(){angular.equals(r.group,l)||(r.changed=!0)}),!0),r.save=function(){!function(){var e=r.group.attributes;for(var t in e)"string"===typeof e[t]&&(e[t]=e[t].split("##"))}(),n.update({realm:t.realm,groupId:r.group.id},r.group,(function(){r.changed=!1,i(r.group),l=angular.copy(r.group),a.success(s.instant("group.edit.success"))}))},r.reset=function(){r.group=angular.copy(l),r.changed=!1},r.cancel=function(){o.url("/realms/"+t.realm+"/groups")},r.addAttribute=function(){r.group.attributes[r.newAttribute.key]=r.newAttribute.value,delete r.newAttribute},r.removeAttribute=function(e){delete r.group.attributes[e]}})),module.controller("GroupRoleMappingCtrl",(function(e,r,t,l,n,a,o,s,i,u,c,d,p,m,g,f){e.realm=l,e.group=n,e.selectedRealmRoles=[],e.selectedRealmMappings=[],e.realmMappings=[],e.clients=a,e.client=o,e.clientRoles=[],e.clientComposite=[],e.selectedClientRoles=[],e.selectedClientMappings=[],e.clientMappings=[],e.dummymodel=[],e.realmMappings=u.query({realm:l.realm,groupId:n.id}),e.realmRoles=d.query({realm:l.realm,groupId:n.id}),e.realmComposite=m.query({realm:l.realm,groupId:n.id}),e.addRealmRole=function(){e.selectedRealmRolesToAdd=JSON.parse("["+e.selectedRealmRoles+"]"),e.selectedRealmRoles=[],r.post(authUrl+"/admin/realms/"+l.realm+"/groups/"+n.id+"/role-mappings/realm",e.selectedRealmRolesToAdd).then((function(){e.realmMappings=u.query({realm:l.realm,groupId:n.id}),e.realmRoles=d.query({realm:l.realm,groupId:n.id}),e.realmComposite=m.query({realm:l.realm,groupId:n.id}),e.selectedRealmMappings=[],e.selectRealmRoles=[],e.selectedClient&&(console.log("load available"),e.clientComposite=g.query({realm:l.realm,groupId:n.id,client:e.selectedClient.id}),e.clientRoles=p.query({realm:l.realm,groupId:n.id,client:e.selectedClient.id}),e.clientMappings=c.query({realm:l.realm,groupId:n.id,client:e.selectedClient.id}),e.selectedClientRoles=[],e.selectedClientMappings=[]),e.selectedRealmRolesToAdd=[],i.success(f.instant("group.roles.add.success"))}))},e.deleteRealmRole=function(){e.selectedRealmMappingsToRemove=JSON.parse("["+e.selectedRealmMappings+"]"),r.delete(authUrl+"/admin/realms/"+l.realm+"/groups/"+n.id+"/role-mappings/realm",{data:e.selectedRealmMappingsToRemove,headers:{"content-type":"application/json"}}).then((function(){e.realmMappings=u.query({realm:l.realm,groupId:n.id}),e.realmRoles=d.query({realm:l.realm,groupId:n.id}),e.realmComposite=m.query({realm:l.realm,groupId:n.id}),e.selectedRealmMappings=[],e.selectRealmRoles=[],e.selectedClient&&(console.log("load available"),e.clientComposite=g.query({realm:l.realm,groupId:n.id,client:e.selectedClient.id}),e.clientRoles=p.query({realm:l.realm,groupId:n.id,client:e.selectedClient.id}),e.clientMappings=c.query({realm:l.realm,groupId:n.id,client:e.selectedClient.id}),e.selectedClientRoles=[],e.selectedClientMappings=[]),e.selectedRealmMappingsToRemove=[],i.success(f.instant("group.roles.remove.success"))}))},e.addClientRole=function(){e.selectedClientRolesToAdd=JSON.parse("["+e.selectedClientRoles+"]"),r.post(authUrl+"/admin/realms/"+l.realm+"/groups/"+n.id+"/role-mappings/clients/"+e.selectedClient.id,e.selectedClientRolesToAdd).then((function(){e.clientMappings=c.query({realm:l.realm,groupId:n.id,client:e.selectedClient.id}),e.clientRoles=p.query({realm:l.realm,groupId:n.id,client:e.selectedClient.id}),e.clientComposite=g.query({realm:l.realm,groupId:n.id,client:e.selectedClient.id}),e.selectedClientRoles=[],e.selectedClientMappings=[],e.realmComposite=m.query({realm:l.realm,groupId:n.id}),e.realmRoles=d.query({realm:l.realm,groupId:n.id}),e.selectedClientRolesToAdd=[],i.success(f.instant("group.roles.add.success"))}))},e.deleteClientRole=function(){e.selectedClientMappingsToRemove=JSON.parse("["+e.selectedClientMappings+"]"),r.delete(authUrl+"/admin/realms/"+l.realm+"/groups/"+n.id+"/role-mappings/clients/"+e.selectedClient.id,{data:e.selectedClientMappingsToRemove,headers:{"content-type":"application/json"}}).then((function(){e.clientMappings=c.query({realm:l.realm,groupId:n.id,client:e.selectedClient.id}),e.clientRoles=p.query({realm:l.realm,groupId:n.id,client:e.selectedClient.id}),e.clientComposite=g.query({realm:l.realm,groupId:n.id,client:e.selectedClient.id}),e.selectedClientRoles=[],e.selectedClientMappings=[],e.realmComposite=m.query({realm:l.realm,groupId:n.id}),e.realmRoles=d.query({realm:l.realm,groupId:n.id}),e.selectedClientMappingsToRemove=[],i.success(f.instant("group.roles.remove.success"))}))},e.changeClient=function(r){if(e.selectedClient=r,!r||!r.id)return e.selectedClient=null,e.clientRoles=null,e.clientMappings=null,void(e.clientComposite=null);e.selectedClient&&(e.clientComposite=g.query({realm:l.realm,groupId:n.id,client:e.selectedClient.id}),e.clientRoles=p.query({realm:l.realm,groupId:n.id,client:e.selectedClient.id}),e.clientMappings=c.query({realm:l.realm,groupId:n.id,client:e.selectedClient.id})),e.selectedClientRoles=[],e.selectedClientMappings=[]},clientSelectControl(e,t.current.params.realm,s)})),module.controller("GroupMembersCtrl",(function(e,r,t,l){e.realm=r,e.page=0,e.group=t,e.query={realm:r.realm,groupId:t.id,max:5,first:0},e.firstPage=function(){e.query.first=0,e.searchQuery()},e.previousPage=function(){e.query.first-=parseInt(e.query.max),e.query.first<0&&(e.query.first=0),e.searchQuery()},e.nextPage=function(){e.query.first+=parseInt(e.query.max),e.searchQuery()},e.searchQuery=function(){console.log("query.search: "+e.query.search),e.searchLoaded=!1,e.users=l.query(e.query,(function(){console.log("search loaded"),e.searchLoaded=!0,e.lastSearch=e.query.search}))},e.searchQuery()})),module.controller("DefaultGroupsCtrl",(function(e,r,t,l,n,a,o,s){e.realm=t,e.groupList=[],e.selectedGroup=null,e.tree=[],e.searchCriteria="",e.currentPage=1,e.currentPageInput=e.currentPage,e.pageSize=20,e.numberOfPages=1;var i=function(){a.query({realm:t.realm},(function(r){e.defaultGroups=r}))},u=function(a){var i=e.currentPage*e.pageSize-e.pageSize;e.currentPageInput=e.currentPage;var u={realm:t.realm,first:i,max:e.pageSize},c={realm:t.realm,top:"true"};angular.isDefined(a)&&""!==a&&(u.search=a,c.search=a);var d=r.defer();l.query(u,(function(e){d.resolve(e)}),(function(){d.reject(s.instant("group.fetch.fail",{params:u}))})),d.promise.then((function(r){e.groupList=r}),(function(e){o.success(e)}));var p=r.defer();n.query(c,(function(e){p.resolve(e)}),(function(){p.reject(s.instant("group.fetch.fail",{params:c}))})),p.promise.then((function(r){angular.isDefined(r.count)&&r.count>e.pageSize&&(e.numberOfPages=Math.ceil(r.count/e.pageSize))}),(function(e){o.success(e)}))};u(),e.$watch("currentPage",(function(r,t){parseInt(r,10)!==parseInt(t,10)&&u(e.searchCriteria)})),e.clearSearch=function(){e.searchCriteria="",1===parseInt(e.currentPage,10)?u():e.currentPage=1},e.searchGroup=function(){1===parseInt(e.currentPage,10)?u(e.searchCriteria):e.currentPage=1},i(),e.addDefaultGroup=function(){e.tree.currentNode?a.update({realm:t.realm,groupId:e.tree.currentNode.id},(function(){i(),o.success(s.instant("group.default.add.success"))})):o.error(s.instant("group.default.add.error"))},e.removeDefaultGroup=function(){a.remove({realm:t.realm,groupId:e.selectedGroup.id},(function(){i(),o.success(s.instant("group.default.remove.success"))}))};e.getGroupClass=function(e){return"realm"===e.id?"pficon pficon-users":function(e){return"realm"!==e.id&&(!e.subGroups||0===e.subGroups.length)}(e)?"normal":e.subGroups.length&&e.collapsed?"collapsed":e.subGroups.length&&!e.collapsed?"expanded":"collapsed"},e.getSelectedClass=function(r){return r.selected?"selected":e.cutNode&&e.cutNode.id===r.id?"cut":void 0}}));